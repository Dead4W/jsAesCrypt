AesCrypt=function(){let e={version:"0.15",bufferSize:32768,fileFormatVersion:2,maxPassLen:1024,AESBlockSize:16};const t={urandom:function(e){return crypto.getRandomValues(new Uint8Array(e))},arrToInt:function(e){return parseInt(Array.prototype.map.call(e,e=>("00"+e.toString(16)).slice(-2)).join(""),16)},bytes2str:function(e){return CryptoJS.enc.Latin1.stringify(CryptoJS.enc.Uint8Arr.parse(e))},str2bytes:function(e,t="Latin1"){return CryptoJS.enc.Uint8Arr.decode(CryptoJS.enc[t].parse(e))}},n={_createKey:async function(e,t,n){return await crypto.subtle.importKey("raw",e.buffer,t,!1,n)},_webHashHMAC:async function(e,t){let n=await this._createKey(t,{name:"HMAC",hash:{name:"SHA-256"}},["sign","verify"]);return new Uint8Array(await crypto.subtle.sign("HMAC",n,e))},_webEncryptAes:async function(e,t,n,r=!0){let a=await this._createKey(t,"AES-CBC",["encrypt","decrypt"]),i=new Uint8Array(await crypto.subtle.encrypt({name:"AES-CBC",iv:n},a,e));return e.length%this.info.AESBlockSize==0&&1==r&&(i=i.slice(0,i.length-this.info.AESBlockSize)),i},_webHashSHA256:async function(e){return new Uint8Array(await crypto.subtle.digest("SHA-256",e.buffer))},_webDecryptAes:async function(e,t,n,r=0){let i=await this._createKey(t,"AES-CBC",["encrypt","decrypt"]),s=a(e);if(0==r){let r=new Uint8Array(this.info.AESBlockSize);for(let t=0;t<this.info.AESBlockSize;t++)r[t]=0^e[e.length-this.info.AESBlockSize+t];modBlockEncrypted=await this._webEncryptAes(r,t,n,!1),s.appendBytes(modBlockEncrypted)}let o=new Uint8Array(await crypto.subtle.decrypt({name:"AES-CBC",iv:n},i,s.finalize()));return 0==r&&(o=o.slice(0,o.length-this.info.AESBlockSize)),o}},r=function(e){let t=0,n=e.size,r=new FileReader,a=e;async function i(e){return await function(e){return new Promise((n,i)=>{let s=a.slice(t,t+=e);r.onload=(()=>{n(new Uint8Array(r.result))}),r.onerror=i,r.readAsArrayBuffer(s)})}(e)}return{readByte:async function(){return(await i(1))[0]},readBytes:i,getCurrentPosition:function(){return t},getLength:function(){return n}}},a=function(e=[]){let t=new Uint8Array(e);return{appendBytes:function(e){let n;if("number"==typeof e){let t=e.toString(16);n=new Uint8Array(t.match(/.{1,2}/g).map(e=>parseInt(e,16)))}else if("string"==typeof e){n=new Uint8Array(e.length);for(let t=0;t<e.length;t++)n[t]=e.charCodeAt(t)}else n=new Uint8Array(e);let r=new Uint8Array(t.length+n.length);r.set(t),r.set(n,t.length),t=r},finalize:function(){return t},get:function(e){return t[e]},getLength:function(){return t.length}}};async function i(e,r){let i=a();i.appendBytes(r),i.appendBytes("\0".repeat(16));let s=i.finalize();for(let r=0;r<8192;r++){let r=a(s);r.appendBytes(t.str2bytes(e,"Utf16LE")),s=await n._webHashSHA256(r.finalize(0))}return s}return n.info=e,{encrypt:async function(s,o){if(o.length>e.maxPassLen)return console.warn("Password is too long."),!1;const c=t.urandom(e.AESBlockSize),l=await i(o,c),y=t.urandom(e.AESBlockSize),p=t.urandom(32);let u=a();u.appendBytes(y),u.appendBytes(p);const f=await n._webEncryptAes(u.finalize(),l,c),w=await n._webHashHMAC(f,l);return await async function(t,i,s,o,c,l){let y=a();y.appendBytes("AES"),y.appendBytes(e.fileFormatVersion),y.appendBytes(0);const p="jsAesCrypt "+e.version;y.appendBytes(0),y.appendBytes(1+("CREATED_BY"+p).length),y.appendBytes("CREATED_BY"),y.appendBytes(0),y.appendBytes(p),y.appendBytes([0,128]),y.appendBytes("\0".repeat(128)),y.appendBytes([0,0]),y.appendBytes(i),y.appendBytes(s),y.appendBytes(c);let u=new r(t),f=u.getLength(),w=a(await u.readBytes(u.getLength())),d=String.fromCharCode(f%e.AESBlockSize);return cText=await n._webEncryptAes(w.finalize(),o,l),hmac0=await n._webHashHMAC(cText,o),y.appendBytes(cText),y.appendBytes(d),y.appendBytes(hmac0),await y.finalize()}(s,c,f,p,w,y)},decrypt:async function(s,o){if(o.length>e.maxPassLen)return console.warn("Password is too long."),!1;let c=r(s);if("AES"!==t.bytes2str(await c.readBytes(3))||c.getLength()<136)return console.warn("File is corrupted or not an AES Crypt \n(or jsAesCrypt) file."),!1;if(await c.readByte()!==e.fileFormatVersion)return console.warn("jsAesCrypt is only compatible with version \n2 of the AES Crypt file format."),!1;for(await c.readByte();;){let e=await c.readBytes(2);if(e.length<2)return console.warn("File is corrupted."),!1;if(0==(e=+t.arrToInt(e)))break;await c.readBytes(e)}let l=await c.readBytes(16);if(16!==l.length)return console.warn("File is corrupted."),!1;let y=await i(o,l),p=await c.readBytes(48);if(48!==p.length)return console.warn("File is corrupted."),!1;let u=t.bytes2str(await c.readBytes(32));if(32!==u.length)return console.warn("File is corrupted."),!1;let f=await n._webHashHMAC(p,y);if(u!==t.bytes2str(f))return console.warn("Wrong password (or file is corrupted)."),!1;let w,d=await n._webDecryptAes(p,y,l,0),A=d.slice(0,e.AESBlockSize),B=d.slice(e.AESBlockSize,e.AESBlockSize+32),h=a(),S=a(await c.readBytes(c.getLength()-c.getCurrentPosition()-32-1)),g=t.arrToInt(await c.readBytes(1));hmac0Act=await n._webHashHMAC(S.finalize(),B);try{w=await n._webDecryptAes(S.finalize(),B,A,g)}catch{w=await n._webDecryptAes(S.finalize(),B,A,0);let t=e.AESBlockSize-g;w=w.slice(0,w.length-t)}h.appendBytes(w);let b=t.bytes2str(await c.readBytes(32));return 32!==b.length?(console.warn("File is corrupted."),!1):b!==t.bytes2str(hmac0Act)?(console.warn("Bad HMAC (file is corrupted)."),!1):h.finalize()},utils:t,info:e}};